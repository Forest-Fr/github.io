// Get DOM elements
const mainModal = document.getElementById('main-modal');
const phoneModal = document.getElementById('phone-modal');
const downloadVCard = document.getElementById('download-vcard');
const sendPhoneButton = document.getElementById('send-phone');
const closeMainModal = document.getElementById('close-main-modal');
const closePhoneModal = document.getElementById('close-phone-modal');
const confirmPhone = document.getElementById('confirm-phone');
const cancelPhone = document.getElementById('cancel-phone');
const phoneError = document.getElementById('phone-error');
const phoneSuccess = document.getElementById('phone-success');

// Open the main modal
downloadVCard.addEventListener('click', () => {
    mainModal.style.display = 'flex';
});

// Close the main modal
closeMainModal.addEventListener('click', () => {
    mainModal.style.display = 'none';
});

// Open Phone modal
sendPhoneButton.addEventListener('click', () => {
    mainModal.style.display = 'none';
    phoneModal.style.display = 'flex';
    resetPhoneModal();
});

// Close Phone modal
closePhoneModal.addEventListener('click', () => {
    phoneModal.style.display = 'none';
});

// Cancel Phone operation
cancelPhone.addEventListener('click', () => {
    phoneModal.style.display = 'none';
});

// Confirm Phone operation and download vCard
confirmPhone.addEventListener('click', () => {
    resetPhoneModal();
    try {
        phoneModal.style.display = 'none';
        window.location.href = 'OliverF.vcf';  // Ensure vCard file exists
        phoneSuccess.textContent = 'Contact successfully saved to your phone.';
        phoneSuccess.style.display = 'block';
        phoneError.style.display = 'none';
        setTimeout(() => phoneSuccess.style.display = 'none', 3000);
    } catch (error) {
        console.error("Error during file download:", error);
        phoneError.textContent = 'Failed to save contact.';
        phoneError.style.display = 'block';
        phoneSuccess.style.display = 'none';
        setTimeout(() => phoneError.style.display = 'none', 3000);
    }
});

// Reset Phone modal message
function resetPhoneModal() {
    phoneError.style.display = 'none';
    phoneSuccess.style.display = 'none';
}

// Click outside the modal to close
window.addEventListener('click', (event) => {
    if (event.target === mainModal) {
        mainModal.style.display = 'none';
    }
    if (event.target === phoneModal) {
        phoneModal.style.display = 'none';
    }
});
